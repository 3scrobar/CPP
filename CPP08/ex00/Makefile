# **************************************************************************** #
#                                                                              #
#                                                         :::      ::::::::    #
#    Makefile                                           :+:      :+:    :+:    #
#                                                     +:+ +:+         +:+      #
#    By: tle-saut <tle-saut@student.42perpignan>    +#+  +:+       +#+         #
#                                                 +#+#+#+#+#+   +#+            #
#    Created: 2025/10/21 13:55:00 by tle-saut          #+#    #+#              #
#    Updated: 2025/10/28 16:11:39 by tle-saut         ###   ########.fr        #
#                                                                              #
# **************************************************************************** #

# ===========================
#        CONFIGURATION
# ===========================

NAME        = find

# Compilateur et flags
CXX         = c++
CXXFLAGS    = -Wall -Wextra -Werror -std=c++98 -g -Iinclude

# Dossiers
SRC_DIR     = src
OBJ_DIR     = obj

# R√©cup√©ration des fichiers .cpp via "find" (pas de wildcard)
SRC := $(shell find $(SRC_DIR) -type f | grep '\.cpp$$' | sort)
OBJ         = $(SRC:$(SRC_DIR)/%.cpp=$(OBJ_DIR)/%.o)
DEP         = $(OBJ:.o=.d)

# ===========================
#         COMMANDES
# ===========================

GREEN   = \033[32m
YELLOW  = \033[33m
BLUE    = \033[36m
RED     = \033[31m
RESET   = \033[0m

ROBOT   = ü§ñ
HAMMER  = üî®
FIRE    = üî•
BROOM   = üßπ
CHECK   = ‚úÖ
TRASH   = üóëÔ∏è
LINK    = üîó
ROCKET  = üöÄ

# ===========================
#          REGLES
# ===========================

.PHONY: all clean fclean re run

# ----- Compilation principale -----
all: $(NAME)
	@echo "$(GREEN)$(CHECK) Compilation termin√©e avec succ√®s !$(RESET)"

# ----- Edition des liens (cr√©ation de l‚Äôex√©cutable) -----
$(NAME): $(OBJ)
	@echo "$(BLUE)$(LINK) √âdition des liens ‚Üí $(NAME)$(RESET)"
	@$(CXX) $(CXXFLAGS) -o $@ $(OBJ)

# ----- Compilation des .cpp en .o -----
$(OBJ_DIR)/%.o: $(SRC_DIR)/%.cpp
	@mkdir -p $(dir $@)
	@echo "$(YELLOW)$(HAMMER) Compilation de $<$(RESET)"
	@$(CXX) $(CXXFLAGS) -MMD -MP -c $< -o $@

# ----- Dossier obj -----
$(OBJ_DIR):
	@mkdir -p $(OBJ_DIR)

# ----- Lancer le programme -----
run: $(NAME)
	@echo "$(ROCKET) Lancement du programme...$(RESET)"
	@./$(NAME) $(ARGS)

# ----- Nettoyage des fichiers objets -----
clean:
	@echo "$(BROOM) Suppression des fichiers objets...$(RESET)"
	@rm -rf $(OBJ_DIR)

# ----- Suppression compl√®te -----
fclean:
	@echo "$(TRASH) Suppression de l‚Äôex√©cutable et des objets...$(RESET)"
	@rm -rf $(OBJ_DIR) $(NAME)

# ----- Recompilation compl√®te -----
re: fclean all

# Inclusion des d√©pendances automatiques (ne relink pas inutilement)
-include $(DEP)

# ===========================
#         FIN DU FICHIER
# ===========================
